BX.namespace("BX.DDAPP.Tools"),BX.DDAPP.Tools.SmtpTest=function(s){this.params=s||{},this.testButton=null,this.messageWrap=null,this.messageOk=null,this.messageError=null,this.messageLoading=null,this.isTesting=!1,this.sessid=BX.bitrix_sessid(),this.init()},BX.DDAPP.Tools.SmtpTest.prototype={init:function(){this.initElements(),this.bindEvents()},initElements:function(){return this.testButton=BX(this.params.buttonId)||BX("smtp_test"),this.messageWrap=BX(this.params.messageWrapId||"smtp_test_result"),this.messageOk=BX(this.params.messageOkId),this.messageError=BX(this.params.messageErrorId),this.messageLoading=BX(this.params.messageLoadingId),this.testButton?!!this.messageWrap||(console.warn("SmtpTest: Message wrap element not found"),!1):(console.warn("SmtpTest: Test button not found"),!1)},bindEvents:function(){this.testButton&&BX.bind(this.testButton,"click",BX.proxy(this.onTestClick,this))},onTestClick:function(s){s.preventDefault(),this.isTesting||this.startTest()},startTest:function(){this.setTestingState(!0),this.showMessage("loading"),BX.ajax({url:this.params.ajaxUrl||"",method:"POST",dataType:"json",timeout:this.params.timeout||30,data:{sessid:this.sessid,action:"smtp_test"},onsuccess:BX.proxy(this.onTestSuccess,this),onfailure:BX.proxy(this.onTestFailure,this),onloadstart:BX.proxy(this.onLoadStart,this),onloadend:BX.proxy(this.onLoadEnd,this)})},onTestSuccess:function(s){s&&s.success?this.showMessage("success",s.message):this.showMessage("error",s&&s.message?s.message:null),s&&s.debug&&console.log("SmtpTest: Debug",s.debug)},onTestFailure:function(s){this.showMessage("ajax_error"),console.error("SmtpTest: AJAX Error",s)},onLoadStart:function(){this.messageWrap&&this.messageWrap.classList.add("loading")},onLoadEnd:function(){this.setTestingState(!1),this.messageWrap&&this.messageWrap.classList.remove("loading")},setTestingState:function(s){this.isTesting=s,this.testButton&&(this.testButton.disabled=s,s?this.testButton.classList.add("ui-btn-wait"):this.testButton.classList.remove("ui-btn-wait"))},showMessage:function(s,t){if(!this.messageWrap)return;this.hideAllMessages();let e="",i=null;switch(s){case"loading":e=this.params.messageLoadingText,i=this.messageLoading;break;case"success":e=this.params.messageSuccessText,t&&(e+=BX.util.htmlspecialchars(t)),i=this.messageOk;break;case"error":e=this.params.messageErrorText,t&&(e+=BX.util.htmlspecialchars(t)),i=this.messageError;break;case"ajax_error":e=this.params.messageAjaxErrorText,i=this.messageError}if(i)i.innerHTML=e,BX.show(i);else{let t="smtp-"+s,i="success"===s?"green":"red";"loading"===s&&(t="smtp-loading",i="#666"),this.messageWrap.innerHTML='<span class="'+t+'" style="color: '+i+';">'+e+"</span>"}},hideAllMessages:function(){this.messageOk&&BX.hide(this.messageOk),this.messageError&&BX.hide(this.messageError),this.messageLoading&&BX.hide(this.messageLoading)},destroy:function(){this.testButton&&BX.unbind(this.testButton,"click",BX.proxy(this.onTestClick,this)),this.testButton=null,this.messageWrap=null,this.messageOk=null,this.messageError=null,this.messageLoading=null,this.isTesting=!1},test:function(){this.isTesting||this.startTest()},isInProgress:function(){return this.isTesting}};