BX.namespace("BX.DDAPP.Tools"),BX.DDAPP.Tools.FormManager=function(e){this.params=e||{},this.form=null,this.modal=null,this.messagesBlock=null,this.submitButton=null,this.isSubmitting=!1,this.recaptchaLoaded=!1,this.sessid=BX.bitrix_sessid(),this.fileConfig=this.params.fileConfig||{},this.selectedFiles=new Map,this.dragCounter=0,this.isMobile=this.detectMobile(),this.analytics=new BX.DDAPP.Tools.Analytics,this.init()},BX.DDAPP.Tools.FormManager.prototype={init:function(){this.form=BX(this.params.formId),this.modal=BX(this.params.modalId),this.messagesBlock=BX(this.params.messagesId),this.submitButton=this.form.querySelector('button[type="submit"]'),"Y"===this.params.useGoogleRecaptcha&&this.loadRecaptcha(),this.bindEvents(),this.initFileHandling(),this.initInputMasks(),this.initMobileOptimizations(),this.trackAnalytics("form_loaded",{form_id:this.params.formId})},detectMobile:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<=768},bindEvents:function(){if(BX.bind(this.form,"submit",BX.proxy(this.onSubmit,this)),this.modal){var e=this;this.modal.addEventListener("hidden.bs.modal",function(){e.onModalHidden(),e.trackAnalytics("form_closed")}),this.modal.addEventListener("shown.bs.modal",function(){e.trackAnalytics("form_opened")})}for(var t=this.form.querySelectorAll("input, textarea, select"),i=0;i<t.length;i++)BX.bind(t[i],"focus",BX.proxy(function(e){this.trackAnalytics("field_focused",{field_type:e.target.type,field_name:e.target.name})},this))},initFileHandling:function(){for(var e=this.form.querySelectorAll('input[type="file"]'),t=0;t<e.length;t++)this.setupFileInput(e[t])},setupFileInput:function(e){var t=this,i=this.createFileWrapper(e);e.parentNode.insertBefore(i,e),i.appendChild(e),e.style.display="none",this.initDragAndDrop(i,e),BX.bind(e,"change",function(e){t.handleFileSelection(e.target,i)});var a=i.querySelector(".file-select-btn");BX.bind(a,"click",function(){e.click()})},createFileWrapper:function(e){var t=e.hasAttribute("multiple"),i=(e.closest(".form-group").querySelector("label").textContent.trim(),document.createElement("div"));return i.className="file-upload-wrapper",i.innerHTML='<div class="file-drop-zone"><div class="drop-content"><div class="drop-icon">üìÅ</div><div class="drop-text">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª'+(t?"—ã":"")+' —Å—é–¥–∞</div><div class="drop-hint">–∏–ª–∏</div><button type="button" class="btn btn-outline-primary file-select-btn">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª'+(t?"—ã":"")+'</button></div></div><div class="file-info"><small><strong>–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:</strong><br>‚Ä¢ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: '+Math.round(this.fileConfig.max_size/1024/1024*10)/10+" MB<br>‚Ä¢ –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã: "+(this.fileConfig.allowed_extensions||[]).join(", ").toUpperCase()+'</small></div><div class="selected-files-preview"></div>',i},initDragAndDrop:function(e,t){var i=this,a=e.querySelector(".file-drop-zone");["dragenter","dragover","dragleave","drop"].forEach(function(e){BX.bind(a,e,function(e){e.preventDefault(),e.stopPropagation()})}),BX.bind(a,"dragenter",function(e){i.dragCounter++,BX.addClass(a,"dragover"),i.trackAnalytics("file_drag_enter")}),BX.bind(a,"dragleave",function(e){i.dragCounter--,0===i.dragCounter&&BX.removeClass(a,"dragover")}),BX.bind(a,"drop",function(s){i.dragCounter=0,BX.removeClass(a,"dragover");var n=s.dataTransfer.files;n.length>0&&(i.handleDroppedFiles(n,t,e),i.trackAnalytics("files_dropped",{count:n.length}))})},handleDroppedFiles:function(e,t,i){var a=new DataTransfer;if(t.hasAttribute("multiple")&&t.files)for(var s=0;s<t.files.length;s++)a.items.add(t.files[s]);for(s=0;s<e.length&&(t.hasAttribute("multiple")||!(s>0));s++)a.items.add(e[s]);t.files=a.files,this.handleFileSelection(t,i)},handleFileSelection:function(e,t){var i=e.files,a=e.name.replace("property_","").replace("[]","");if(this.clearFileValidationError(t),0===i.length)return this.updateFilePreview(t,[]),void this.selectedFiles.delete(a);for(var s=[],n=[],r=0;r<i.length;r++){var o=i[r],l=this.validateSingleFile(o);0===l.length?s.push(o):n=n.concat(l)}n.length>0?(this.showFileValidationError(t,n),e.value="",this.trackAnalytics("file_validation_failed",{errors_count:n.length,files_count:i.length})):(this.selectedFiles.set(a,s),this.updateFilePreview(t,s),this.trackAnalytics("files_selected",{count:s.length,total_size:Array.from(s).reduce((e,t)=>e+t.size,0)}))},validateSingleFile:function(e){var t=[],i=this.fileConfig.max_size||10485760,a=this.fileConfig.allowed_extensions||[],s=this.fileConfig.forbidden_extensions||[],n=e.name.toLowerCase().split(".").pop();if(e.size>i){var r=Math.round(i/1024/1024*10)/10;t.push('–§–∞–π–ª "'+e.name+'" –ø—Ä–µ–≤—ã—à–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä ('+r+" MB)")}return-1!==s.indexOf(n)?(t.push('–¢–∏–ø —Ñ–∞–π–ª–∞ "'+n+'" –∑–∞–ø—Ä–µ—â–µ–Ω –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏'),t):(a.length>0&&-1===a.indexOf(n)&&t.push('–¢–∏–ø —Ñ–∞–π–ª–∞ "'+n+'" –Ω–µ —Ä–∞–∑—Ä–µ—à–µ–Ω'),this.isFileNameSuspicious(e.name)&&t.push('–ò–º—è —Ñ–∞–π–ª–∞ "'+e.name+'" —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã'),t)},updateFilePreview:function(e,t){var i=e.querySelector(".selected-files-preview");if(i.innerHTML="",0!==t.length){var a=document.createElement("div");a.className="selected-files";for(var s=0;s<t.length;s++){var n=t[s],r=this.createFilePreviewItem(n,s,e);a.appendChild(r)}i.appendChild(a)}},createFilePreviewItem:function(e,t,i){var a=this,s=document.createElement("div");s.className="file-item";var n=this.formatFileSize(e.size),r=this.isImageFile(e);s.innerHTML='<div class="file-info-block">'+(r?'<div class="file-thumbnail"></div>':'<div class="file-icon">üìÑ</div>')+'<div class="file-details"><div class="file-name">'+e.name+'</div><div class="file-size">'+n+'</div></div></div><button type="button" class="file-remove" title="–£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª">√ó</button>',r&&this.createImageThumbnail(e,s.querySelector(".file-thumbnail"));var o=s.querySelector(".file-remove");return BX.bind(o,"click",function(){a.removeFileFromSelection(i,t),a.trackAnalytics("file_removed",{file_name:e.name})}),s},createImageThumbnail:function(e,t){if(e.type.startsWith("image/")){var i=new FileReader;i.onload=function(e){var i=document.createElement("img");i.src=e.target.result,i.className="thumbnail-image",i.style.maxWidth="50px",i.style.maxHeight="50px",i.style.objectFit="cover",t.appendChild(i)},i.readAsDataURL(e)}},removeFileFromSelection:function(e,t){var i=e.querySelector('input[type="file"]'),a=i.name.replace("property_","").replace("[]",""),s=Array.from(this.selectedFiles.get(a)||[]);if(s.splice(t,1),0===s.length)this.selectedFiles.delete(a),i.value="";else{this.selectedFiles.set(a,s);var n=new DataTransfer;s.forEach(function(e){n.items.add(e)}),i.files=n.files}this.updateFilePreview(e,s)},isImageFile:function(e){return e.type.startsWith("image/")},formatFileSize:function(e){if(0===e)return"0 B";var t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(1))+" "+["B","KB","MB","GB"][t]},initMobileOptimizations:function(){if(this.isMobile){BX.addClass(this.form,"mobile-optimized");for(var e=this.form.querySelectorAll("input, button, select, textarea"),t=0;t<e.length;t++)BX.addClass(e[t],"mobile-input");this.enableErrorScrolling(),this.handleVirtualKeyboard()}},enableErrorScrolling:function(){var e=this;this.originalShowMessage=this.showMessage,this.showMessage=function(t,i){e.originalShowMessage.call(e,t,i),"error"===i&&e.messagesBlock&&setTimeout(function(){e.messagesBlock.scrollIntoView({behavior:"smooth",block:"center"})},100)}},handleVirtualKeyboard:function(){var e=window.innerHeight;window.addEventListener("resize",function(){var t=window.innerHeight,i=e-t;document.body.style.height=i>150?t+"px":""})},isFileNameSuspicious:function(e){return/[<>:"|?*]/.test(e)||-1!==e.substring(0,e.lastIndexOf(".")).indexOf(".")},showFileValidationError:function(e,t){var i=document.createElement("div");i.className="file-validation-error text-danger mt-2",i.innerHTML=t.join("<br>"),e.appendChild(i),BX.addClass(e,"has-error"),BX.addClass(e,"shake"),setTimeout(function(){BX.removeClass(e,"shake")},500)},clearFileValidationError:function(e){var t=e.querySelector(".file-validation-error");t&&t.remove(),BX.removeClass(e,"has-error")},loadRecaptcha:function(){if(!this.recaptchaLoaded&&this.params.recaptchaPublicKey){var e=document.createElement("script");e.src="https://www.google.com/recaptcha/api.js?render="+this.params.recaptchaPublicKey,e.onload=BX.proxy(function(){this.recaptchaLoaded=!0},this),document.head.appendChild(e)}},onSubmit:function(e){return e.preventDefault(),!this.isSubmitting&&(this.hideMessage(),this.trackAnalytics("form_submit_attempt"),this.validateForm()?this.validateAllFiles()?void("Y"===this.params.useGoogleRecaptcha?this.submitWithRecaptcha():this.submitForm()):(this.showMessage("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏ –≤ –∑–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö —Ñ–∞–π–ª–∞—Ö","error"),this.trackAnalytics("file_validation_failed_on_submit"),!1):(this.trackAnalytics("form_validation_failed"),!1))},validateForm:function(){var e=!0,t=[];this.clearValidationErrors();var i=this.form.querySelector("#privacy_policy_agreement");i&&!i.checked&&(e=!1,t.push("–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–∞—Ç—å —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö"),this.addValidationError(i.closest(".form-group"),"–°–æ–≥–ª–∞—Å–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ"),this.trackAnalytics("form_validation_error",{error_type:"privacy_policy_missing"}));for(var a=this.form.querySelectorAll("[required]"),s=0;s<a.length;s++){var n=a[s];if(!n.value.trim()||"checkbox"===n.type&&!n.checked){e=!1;var r=n.closest(".form-group")||n.closest(".form-check");r&&this.addValidationError(r,"–≠—Ç–æ –ø–æ–ª–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è")}}return e||(this.showMessage(t.join(". "),"error"),this.trackAnalytics("form_validation_failed",{errors_count:t.length})),e},addValidationError:function(e,t){if(e){e.classList.add("has-error");var i=e.querySelector(".error-message");i&&i.remove();var a=document.createElement("div");a.className="error-message text-danger small mt-1",a.innerHTML='<i class="fas fa-exclamation-triangle me-1"></i>'+t,e.appendChild(a)}},clearValidationErrors:function(){for(var e=this.form.querySelectorAll(".has-error"),t=0;t<e.length;t++)e[t].classList.remove("has-error");for(var i=this.form.querySelectorAll(".error-message"),a=0;a<i.length;a++)i[a].remove()},validateAllFiles:function(){for(var e=this.form.querySelectorAll('input[type="file"]'),t=!0,i=0;i<e.length;i++)if(e[i].files&&e[i].files.length>0)for(var a=0;a<e[i].files.length;a++){if(this.validateSingleFile(e[i].files[a]).length>0){t=!1;break}}return t},getFieldValue:function(e){if("checkbox"===e.type||"radio"===e.type){var t=e.name;return this.form.querySelectorAll('input[name="'+t+'"]:checked').length>0}return"file"===e.type?e.files&&e.files.length>0:e.value.trim()},addValidationError:function(e){BX.addClass(e,"is-invalid");var t=e.closest(".form-group");t&&BX.addClass(t,"has-error")},clearValidationErrors:function(){for(var e=this.form.querySelectorAll(".is-invalid"),t=0;t<e.length;t++)BX.removeClass(e[t],"is-invalid");for(var i=this.form.querySelectorAll(".has-error"),a=0;a<i.length;a++)BX.removeClass(i[a],"has-error");for(var s=this.form.querySelectorAll(".file-validation-error"),n=0;n<s.length;n++)s[n].remove()},submitWithRecaptcha:function(){var e=this;this.recaptchaLoaded&&"undefined"!=typeof grecaptcha?grecaptcha.ready(function(){grecaptcha.execute(e.params.recaptchaPublicKey,{action:"submit"}).then(function(t){var i=document.createElement("input");i.type="hidden",i.name="g-recaptcha-response",i.value=t,e.form.appendChild(i),e.submitForm()})}):this.showMessage("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ reCAPTCHA","error")},initInputMasks:function(){if("undefined"!=typeof Inputmask){for(var e=this.form.querySelectorAll(".masked-input"),t=0;t<e.length;t++)this.setupInputMask(e[t]);"undefined"!=typeof console&&console.log("Input masks initialized:",e.length)}else console.warn("Inputmask library not loaded")},setupInputMask:function(e){var t=e.getAttribute("data-mask-type");"phone"===t?this.setupPhoneMask(e):"email"===t&&this.setupEmailMask(e)},setupPhoneMask:function(e){var t=this,i=new Inputmask({mask:["+7 (999) 999-99-99","+9{1,4} 999 999 999","+9{1,4} 999 999 9999","+9{1,4} 999 999 99999"],showMaskOnHover:!1,showMaskOnFocus:!0,placeholder:"_",clearIncomplete:!0,autoUnmask:!1,removeMaskOnSubmit:!1,onBeforePaste:function(e,t){var i=e.replace(/\D/g,"");return 11===i.length&&"8"===i[0]&&(i="7"+i.substring(1)),11===i.length&&"7"===i[0]&&(i="+"+i),i},onincomplete:function(){BX.addClass(e,"is-invalid"),BX.removeClass(e,"is-valid")},oncomplete:function(){BX.removeClass(e,"is-invalid"),BX.addClass(e,"is-valid"),t.trackAnalytics("phone_complete",{field_name:e.name,phone_length:e.value.length})},onKeyValidation:function(t,i){!i&&e&&(e.style.borderColor="#dc3545",setTimeout(function(){e.style.borderColor=""},300))}});i.mask(e),e._inputmask=i,BX.bind(e,"focus",function(){""!==this.value&&"+7 (___) ___-__-__"!==this.value||(this.value="+7 ",setTimeout(function(){e.setSelectionRange&&e.setSelectionRange(3,3)},10))}),BX.bind(e,"blur",function(){i.unmaskedvalue&&0===i.unmaskedvalue().length&&(this.value="",BX.removeClass(this,"is-valid"),BX.removeClass(this,"is-invalid"))}),BX.bind(e,"input",function(){if(i.unmaskedvalue){var a=i.unmaskedvalue();a.length>=5&&a.length<=15&&t.trackAnalytics("phone_progress",{field_name:e.name,digits_entered:a.length})}})},setupEmailMask:function(e){var t=this;BX.bind(e,"input",function(){var e=this.value.toLowerCase();this.value=e;var i=t.validateEmail(e);e.length>0?i?(BX.removeClass(this,"is-invalid"),BX.addClass(this,"is-valid")):(BX.removeClass(this,"is-valid"),BX.addClass(this,"is-invalid")):(BX.removeClass(this,"is-valid"),BX.removeClass(this,"is-invalid")),t.handleEmailAutocomplete(this,e)}),BX.bind(e,"keydown",function(e){var t;9===e.keyCode&&this.getAttribute("data-suggestion")&&(e.preventDefault(),this.value=this.getAttribute("data-suggestion"),this.removeAttribute("data-suggestion"),this.placeholder="example@domain.com","function"==typeof Event?t=new Event("input",{bubbles:!0}):(t=document.createEvent("Event")).initEvent("input",!0,!0),this.dispatchEvent(t))})},handleEmailAutocomplete:function(e,t){if(!t.includes("@")||t.includes("."))return e.removeAttribute("data-suggestion"),void(e.placeholder="example@domain.com");var i=t.split("@");if(2===i.length&&i[1].length>0)for(var a=i[1],s=["gmail.com","yandex.ru","mail.ru","outlook.com","hotmail.com","yahoo.com","rambler.ru","inbox.ru"],n=0;n<s.length;n++)if(0===s[n].indexOf(a)&&s[n]!==a){var r=i[0]+"@"+s[n];return e.setAttribute("data-suggestion",r),void(e.placeholder=r)}e.removeAttribute("data-suggestion"),e.placeholder="example@domain.com"},setupEmailValidation:function(e){var t=this;BX.bind(e,"input",function(e){var i=e.target.value.toLowerCase();e.target.value=i;var a=t.validateEmail(i);i.length>0?a?(BX.removeClass(e.target,"is-invalid"),BX.addClass(e.target,"is-valid")):(BX.removeClass(e.target,"is-valid"),BX.addClass(e.target,"is-invalid")):(BX.removeClass(e.target,"is-valid"),BX.removeClass(e.target,"is-invalid")),a&&i.length>5&&t.trackAnalytics("email_valid",{field_name:e.target.name,domain:i.split("@")[1]||""})}),BX.bind(e,"keyup",function(e){if(9!==e.keyCode&&13!==e.keyCode){var i=e.target.value;if(i.includes("@")&&!i.includes(".")){var a=i.split("@");if(2===a.length&&a[1].length>0)for(var s=a[1],n=["gmail.com","yandex.ru","mail.ru","outlook.com","yahoo.com"],r=0;r<n.length;r++)if(0===n[r].indexOf(s)){var o=a[0]+"@"+n[r];t.showEmailSuggestion(e.target,o,a[0].length+1+s.length);break}}}})},validateEmail:function(e){return/^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$/.test(e.toLowerCase())},showEmailSuggestion:function(e,t,i){e.value.length<t.length&&(e.setAttribute("data-suggestion",t),""===e.value&&(e.placeholder=t))},validateMaskedFields:function(){for(var e=this.form.querySelectorAll(".masked-input"),t=[],i=0;i<e.length;i++){var a=e[i],s=a.getAttribute("data-mask-type"),n=a.value.trim();a.hasAttribute("required")&&""===n||""!==n&&("email"!==s||this.validateEmail(n)?"phone"!==s||this.validatePhone(n)||t.push('–ü–æ–ª–µ "'+this.getFieldLabel(a)+'" –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞'):t.push('–ü–æ–ª–µ "'+this.getFieldLabel(a)+'" –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email –∞–¥—Ä–µ—Å'))}return t},validatePhone:function(e){var t=e.replace(/\D/g,"");return 11===t.length&&"7"===t[0]||t.length>=7&&t.length<=15},getFieldLabel:function(e){var t=this.form.querySelector('label[for="'+e.id+'"]');return t?t.textContent.replace("*","").trim():e.name},getPhoneValue:function(e){return e._inputmask&&e._inputmask.unmaskedvalue?e._inputmask.unmaskedvalue():e.value.replace(/\D/g,"")},setPhoneValue:function(e,t){e._inputmask&&e._inputmask.setValue?e._inputmask.setValue(t):e.value=t},submitForm:function(){this.isSubmitting=!0,this.setSubmitButtonState(!0),this.trackAnalytics("form_submit_started");for(var e=new FormData(this.form),t=this.form.querySelectorAll('input[data-mask-type="phone"]'),i=0;i<t.length;i++){var a=t[i],s=this.getPhoneValue(a);if(s&&s.length>0){var n=s;(11===s.length&&"7"===s[0]||"+"!==s[0])&&(n="+"+s),e.set(a.name,n)}}e.append("sessid",this.sessid);var r=this;BX.ajax({method:"POST",dataType:"json",url:window.location.href,data:e,processData:!1,start:function(){r.trackAnalytics("ajax_request_started")},onsuccess:function(e){r.onSuccess(e)},onfailure:function(){r.onFailure()}})},onSuccess:function(e){this.isSubmitting=!1,this.setSubmitButtonState(!1),e.success?(this.showMessage(e.message,"success"),this.resetForm(),this.trackAnalytics("form_submit_success",{element_id:e.element_id}),setTimeout(BX.proxy(this.hideModal,this),2e3)):(this.showMessage(e.message,"error"),this.trackAnalytics("form_submit_error",{error_message:e.message}))},onFailure:function(){this.isSubmitting=!1,this.setSubmitButtonState(!1),this.showMessage("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã","error"),this.trackAnalytics("form_submit_failure")},setSubmitButtonState:function(e){this.submitButton&&(this.submitButton.disabled=e,this.submitButton.innerHTML=e?'<span class="spinner-border spinner-border-sm me-2"></span>–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è...':"–û—Ç–ø—Ä–∞–≤–∏—Ç—å")},resetForm:function(){this.form.reset(),this.clearValidationErrors(),this.selectedFiles.clear();for(var e=this.form.querySelectorAll(".selected-files-preview"),t=0;t<e.length;t++)e[t].innerHTML=""},hideModal:function(){if(this.modal){var e=bootstrap.Modal.getInstance(this.modal);if(e)e.hide();else new bootstrap.Modal(this.modal).hide()}},onModalHidden:function(){this.resetForm(),this.hideMessage()},showMessage:function(e,t){this.messagesBlock&&(this.messagesBlock.innerHTML=e,this.messagesBlock.className="alert alert-"+("success"===t?"success":"danger"),this.messagesBlock.style.display="block","success"===t&&this.isMobile&&setTimeout(BX.proxy(this.hideMessage,this),3e3))},hideMessage:function(){this.messagesBlock&&(this.messagesBlock.style.display="none",this.messagesBlock.innerHTML="")},trackAnalytics:function(e,t){this.analytics.track(e,Object.assign({form_id:this.params.formId,timestamp:Date.now()},t||{}))},addCustomValidator:function(e){},getFormData:function(){return new FormData(this.form)},destroy:function(){this.selectedFiles.clear()}},BX.DDAPP.Tools.Analytics=function(){this.queue=[],this.init()},BX.DDAPP.Tools.Analytics.prototype={init:function(){"undefined"!=typeof gtag&&this.processQueue(),window.ddappAnalytics&&(this.queue=this.queue.concat(window.ddappAnalytics),this.processQueue())},track:function(e,t){var i={event_name:e,parameters:t||{}};this.queue.push(i),this.processQueue()},processQueue:function(){if("undefined"!=typeof gtag)for(;this.queue.length>0;){var e=this.queue.shift();if(gtag("event",e.event_name,e.parameters),"undefined"!=typeof ym&&window.yaCounter){var t=this.mapEventToYandexGoal(e.event_name);t&&ym(window.yaCounter,"reachGoal",t,e.parameters)}}},mapEventToYandexGoal:function(e){return{form_submit_success:"form_submit",form_opened:"form_view",files_selected:"file_upload"}[e]||null}};